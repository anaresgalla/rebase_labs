#!/bin/bash

docker network rm defaultNetwork

docker network create defaultNetwork

docker run \
    -d \
    --rm \
    --name pgrebase \
    --network defaultNetwork \
    -e POSTGRES_DB=rebaselabs \
    -e POSTGRES_USER=rebase \
    -e POSTGRES_PASSWORD=rebaselabs \
    postgres

docker run \
  --rm \
  --name rebaselabserver \
  --network defaultNetwork \
  -w /app \
  -v .:/app \
  ruby \
  bash -c "bundle install && ruby import_from_csv.rb && bundle exec rspec"

docker stop pgrebase
